!function(e,c){var t=function(e,t){this.rpt=null,this.keycloak=e,this.options=t,this.config=null,this.init(this)};t.prototype.init=function(){var e=this,t=new XMLHttpRequest;t.open("GET",this.keycloak.authServerUrl+"/realms/"+this.keycloak.realm+"/.well-known/uma2-configuration"),t.onreadystatechange=function(){4==t.readyState&&(200==t.status?e.config=JSON.parse(t.responseText):console.error("Could not obtain configuration from server."))},t.send(null)},t.prototype.authorize=function(s){var a=this;return this.then=function(o,n,r){if(s&&s.ticket){var i=new XMLHttpRequest;i.open("POST",a.config.token_endpoint,!0),i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.setRequestHeader("Authorization","Bearer "+this.keycloak.token),i.onreadystatechange=function(){if(4==i.readyState){var e=i.status;if(200<=e&&e<300){var t=JSON.parse(i.responseText).access_token;a.rpt=t,o(t)}else 403==e?n?n():console.error("Authorization request was denied by the server."):r?r():console.error("Could not obtain authorization data from server.")}};var e="grant_type=urn:ietf:params:oauth:grant-type:uma-ticket&client_id="+this.keycloak.clientId+"&ticket="+s.ticket;s.submitRequest!=c&&(e+="&submit_request="+s.submitRequest);var t=s.metadata;t&&(t.responseIncludeResourceName&&(e+="&response_include_resource_name="+t.responseIncludeResourceName),t.responsePermissionsLimit&&(e+="&response_permissions_limit="+t.responsePermissionsLimit)),a.rpt&&(s.incrementalAuthorization==c||s.incrementalAuthorization)&&(e+="&rpt="+a.rpt),i.send(e)}},this},t.prototype.entitlement=function(l,m){var d=this;return this.then=function(o,n,r){var s=new XMLHttpRequest;s.open("POST",d.config.token_endpoint,!0),s.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s.setRequestHeader("Authorization","Bearer "+this.keycloak.token),s.onreadystatechange=function(){if(4==s.readyState){var e=s.status;if(200<=e&&e<300){var t=JSON.parse(s.responseText).access_token;d.rpt=t,o(t)}else 403==e?n?n():console.error("Authorization request was denied by the server."):r?r():console.error("Could not obtain authorization data from server.")}},m||(m={});var e="grant_type=urn:ietf:params:oauth:grant-type:uma-ticket&client_id="+this.keycloak.clientId;m.claimToken&&(e+="&claim_token="+m.claimToken,m.claimTokenFormat&&(e+="&claim_token_format="+m.claimTokenFormat)),e+="&audience="+l;var t=m.permissions;for(t||(t=[]),i=0;i<t.length;i++){var a=t[i],c=a.id;if(a.scopes&&0<a.scopes.length)for(c+="#",j=0;j<a.scopes.length;j++){var u=a.scopes[j];c.indexOf("#")!=c.length-1&&(c+=","),c+=u}e+="&permission="+c}var p=m.metadata;p&&(p.responseIncludeResourceName&&(e+="&response_include_resource_name="+p.responseIncludeResourceName),p.responsePermissionsLimit&&(e+="&response_permissions_limit="+p.responsePermissionsLimit)),d.rpt&&(e+="&rpt="+d.rpt),s.send(e)},this},"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=t:(e.KeycloakAuthorization=t,"function"==typeof define&&define.amd&&define("keycloak-authorization",[],function(){return t}))}(window);